<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theatre Plays</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <nav>
        <div class="nav-content">
            <div class="site-title">Theatre Plays</div>
            <button class="burger-menu" onclick="toggleMobileMenu()">
                <span></span>
                <span></span>
                <span></span>
            </button>
            <div class="nav-links">
                <a class="nav-link" id="dashboardLink" onclick="displayPlays('dashboard')">Dashboard</a>
                <a class="nav-link active" id="allPlaysLink" onclick="displayPlays('all')">All Plays</a>
                <a class="nav-link" id="upcomingPlaysLink" onclick="displayPlays('upcoming')">Upcoming Plays</a>
                <a class="nav-link" id="seenPlaysLink" onclick="displayPlays('seen')">Seen Plays</a>
                <a class="nav-link" id="hallOfFamePlaysLink" onclick="displayPlays('hallOfFame')">Hall of Fame</a>
                <a class="nav-link" id="calendarLink" onclick="displayCalendarSection()">Calendar</a>
                <a class="nav-link" id="addPlayLink" onclick="showAddPlayForm()">Add Play</a>
                <div class="auth-buttons">
                    <button id="signInBtn" onclick="signInWithGoogle()">Sign in with Google</button>
                    <button id="signOutBtn" onclick="signOut()" style="display: none;">Sign Out</button>
                    <div id="userInfo" style="display: none;"></div>
                </div>
            </div>
        </div>
    </nav>

    <div class="main-content">
        <button class="calendar-toggle" onclick="toggleCalendarView()" style="display: none;">
            Toggle Calendar View
        </button>
        <button class="hall-toggle" onclick="toggleHallView()" style="display: none;">
            Toggle Hall of Shame
        </button>
        <div class="calendar-container"></div>
        <div class="play-grid"></div>
        <div class="add-play-form" style="display: none;">
            <h2>Add New Play</h2>
            <form id="addPlayForm">
                <div class="form-group">
                    <label for="playName">Play Name *</label>
                    <input type="text" id="playName" name="playName" required>
                </div>

                <div class="form-group">
                    <label for="playDate">Date *</label>
                    <input type="date" id="playDate" name="playDate" required>
                </div>

                <div class="form-group">
                    <label for="playTheatre">Theatre (optional)</label>
                    <input type="text" id="playTheatre" name="playTheatre">
                </div>

                <div class="form-group">
                    <label for="playRating">Rating (optional)</label>
                    <div class="rating-container">
                        <div class="moon-rating-new">
                            <div class="moon-rating-wrapper">
                                <div class="moon-item" data-value="1">
                                    <i class="fa-solid fa-moon"></i>
                                </div>
                                <div class="moon-item" data-value="2">
                                    <i class="fa-solid fa-moon"></i>
                                </div>
                                <div class="moon-item" data-value="3">
                                    <i class="fa-solid fa-moon"></i>
                                </div>
                                <div class="moon-item" data-value="4">
                                    <i class="fa-solid fa-moon"></i>
                                </div>
                                <div class="moon-item" data-value="5">
                                    <i class="fa-solid fa-moon"></i>
                                </div>
                            </div>
                            <div class="standing-ovation-btn" data-value="Standing Ovation">
                                <i class="fa-solid fa-person"></i> Standing Ovation
                            </div>
                        </div>
                        <input type="hidden" id="ratingValue" name="rating" value="">
                        <div class="rating-hint">Click a moon to select rating. Click the same moon again for half rating.</div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="playImage">Image URL (optional)</label>
                    <input type="url" id="playImage" name="playImage" placeholder="https://...">
                    <div class="image-preview">Image preview will appear here</div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="submit-btn">Add Play</button>
                    <button type="button" class="cancel-btn" onclick="hideAddPlayForm()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script src="/nav-styles.js"></script>
    <script src="/google-auth.js"></script>
    <script src="/database.js"></script>
    <script src="/calendar-view.js"></script>
    <script src="/auth.js"></script>
    <script src="/toast-notifications.js"></script>
    <script>
        function toggleMobileMenu() {
            document.querySelector('.nav-links').classList.toggle('active');
            document.querySelector('.burger-menu').classList.toggle('active');
        }

        // Close mobile menu when clicking outside
        document.addEventListener('click', (e) => {
            const nav = document.querySelector('nav');
            const burger = document.querySelector('.burger-menu');
            if (!nav.contains(e.target) && document.querySelector('.nav-links').classList.contains('active')) {
                document.querySelector('.nav-links').classList.remove('active');
                burger.classList.remove('active');
            }
        });

        // Close mobile menu when clicking a nav link
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', () => {
                document.querySelector('.nav-links').classList.remove('active');
                document.querySelector('.burger-menu').classList.remove('active');
            });
        });

        function testToastButton() {
            console.log('Test button clicked');
            if (typeof showToast === 'function') {
                showToast({
                    title: 'Test Button Toast',
                    message: 'This is a test from the direct button',
                    type: 'success',
                    duration: 3000
                });
                console.log('Toast called from test button');
            } else {
                console.error('showToast is not available');
                alert('Toast function not available');
            }
        }

        // Global form interceptor that works regardless of how the form is handled
        document.addEventListener('DOMContentLoaded', function() {
            // Listen for form submission
            document.body.addEventListener('submit', function(event) {
                // If this is our add play form
                if (event.target.id === 'addPlayForm') {
                    // Extract the form data
                    const formData = {
                        name: document.getElementById('playName').value,
                        date: document.getElementById('playDate').value,
                        theatre: document.getElementById('playTheatre').value || null,
                        rating: document.getElementById('ratingValue').value || null,
                        image: document.getElementById('playImage')?.value || null
                    };
                    
                    // Set a timeout to show toast after form processing
                    setTimeout(function() {
                        try {
                            // Format date for display
                            const formattedDate = new Date(formData.date).toLocaleDateString('en-US', {
                                weekday: 'long',
                                year: 'numeric', 
                                month: 'long',
                                day: 'numeric'
                            });
                            
                            // Format rating for display
                            let displayRating = 'Not Rated';
                            if (formData.rating) {
                                if (formData.rating === 'Standing Ovation' || formData.rating === 6) {
                                    displayRating = 'Standing Ovation';
                                } else {
                                    const ratingValue = typeof formData.rating === 'string' ? 
                                        parseFloat(formData.rating) : formData.rating;
                                    
                                    if (!isNaN(ratingValue)) {
                                        displayRating = `${ratingValue} ${ratingValue === 1 ? 'Moon' : 'Moons'}`;
                                    }
                                }
                            }
                            
                            showToast({
                                title: 'Play Added Successfully',
                                message: `Play successfully added`,
                                type: 'success',
                                duration: 5000,
                                details: {
                                    'Play': formData.name,
                                    'Date': formattedDate,
                                    'Theatre': formData.theatre || 'Not specified',
                                    'Rating': displayRating,
                                    'Image': formData.image ? 'Yes' : 'No'
                                }
                            });
                        } catch (error) {
                            console.error('Error showing toast:', error);
                        }
                    }, 500); // Short delay to let the form processing complete
                }
            });
        });

        // Function to apply mobile styles directly
        function applyMobileStyles() {
            // Only apply on mobile devices
            if (window.innerWidth <= 767) {
                console.log("Applying mobile-specific styles");
                
                // Create a style element
                const styleEl = document.createElement('style');
                styleEl.id = 'mobile-card-fix';
                
                // Add highly specific CSS rules
                styleEl.textContent = `
                    /* Target card grid directly */
                    body .play-grid, 
                    body .main-content .play-grid {
                        display: block !important;
                        grid-template-columns: none !important;
                        padding: 10px !important;
                    }
                    
                    /* Target cards */
                    body .play-grid .play-card,
                    body .main-content .play-grid .play-card {
                        width: 100% !important;
                        max-width: 100% !important;
                        margin: 0 0 20px 0 !important;
                        box-sizing: border-box !important;
                    }
                    
                    /* Target card content */
                    body .play-card .play-card-content,
                    body .play-grid .play-card .play-card-content {
                        width: 100% !important;
                        box-sizing: border-box !important;
                    }
                    
                    /* Target image container */
                    body .play-card .image-container,
                    body .play-card-content .image-container {
                        width: 100% !important;
                        height: auto !important;
                        max-height: none !important;
                    }
                    
                    /* Target images */
                    body .play-card .image-container img,
                    body .play-card-content .image-container img {
                        width: 100% !important;
                        height: auto !important;
                        max-height: none !important;
                    }
                `;
                
                // Remove any existing instance
                const existingStyle = document.getElementById('mobile-card-fix');
                if (existingStyle) {
                    existingStyle.remove();
                }
                
                // Add to head
                document.head.appendChild(styleEl);
            }
        }
        
        // Apply styles immediately and when window resizes
        applyMobileStyles();
        window.addEventListener('resize', applyMobileStyles);
        
        // Also apply after a slight delay to make sure it overrides everything
        setTimeout(applyMobileStyles, 500);
        setTimeout(applyMobileStyles, 1000);
        setTimeout(applyMobileStyles, 2000);
    </script>
</body>
</html> 